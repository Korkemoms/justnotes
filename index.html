<!DOCTYPE html>
<html>
  <head>
    <title>Justnotes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Justnotes is a simple note taking app that stores notes on your device. No information is sent anywhere."
    />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Ubuntu", sans-serif;
        padding: 20px;
        background-color: #fefefe;
      }

      .content {
        margin: auto;
        max-width: 700px;
      }

      li {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 15px 15px;
        margin: 10px 0;
        box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
        background-color: #fff;
      }

      ul {
        list-style-type: none;
        padding: 0;
      }

      form {
        display: flex;
      }

      .header {
        display: flex;
        justify-content: space-between;

        align-items: center;
      }

      .buttonContainer {
        display: flex;
        flex-wrap: nowrap;
      }

      .save {
        background-color: #8e44ad;
        color: white;
        border: none;
        padding: 10px;
        border-radius: 5px;
        cursor: pointer;
        box-sizing: border-box;
        width: 100%;
        margin-top: 10px;
        margin-bottom: 20px;
      }

      .save:hover {
        background-color: #6c3483;
      }

      .edit {
        background: transparent;
        color: white;
        border: none;
        padding: 5px;
        margin-left: 10px;
        border-radius: 5px;
        cursor: pointer;
      }

      .delete {
        background: transparent;
        color: white;
        border: none;
        padding: 5px;
        margin-left: 10px;
        border-radius: 5px;
        cursor: pointer;
      }

      .edit:hover,
      .delete:hover {
        background-color: #6c3483;
      }

      .main-entry {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        width: 100%;
        box-sizing: border-box;
        height: 100px;
        font-size: 16px;
      }

      h1 {
        color: #333;
      }

      h3 {
        margin: 0;
      }

      .card-edit {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
        height: 100px;
        font-size: 16px;
      }

      .card-edit-button {
        background-color: #8e44ad;
        color: white;
        border: none;
        padding: 5px;
        border-radius: 5px;
        cursor: pointer;
      }

      .card-edit-button-container {
        display: flex;
        justify-content: flex-end;
        margin-top: 10px;
        gap: 10px;
      }
    </style>
  </head>

  <body>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/gh/vanjs-org/van/public/van-1.5.2.nomodule.min.js"
    ></script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/dexie/4.0.8/dexie.js"
      integrity="sha512-yMqpbs8CKZDoPZlDuOrtlnvvxOEpeG7mtiQW9KeDUds97Mwmb4OFDA6ZS0obDSVqcDl65rQlan1cS3K2HDR0yg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script>
      const { div, h1, p, textarea, button, ul, li, h3 } = van.tags;

      const contentDiv = div(
        { class: "content" },
        h1("Just enter some notes"),
        p("They are stored on your device, no information is sent anywhere"),
        textarea({
          class: "main-entry",
          type: "text",
          id: "note",
          placeholder: "Enter a note",
          autofocus: true,
        }),
        button({ onclick: saveNote, class: "save" }, "Save"),
        ul({ id: "notes" })
      );

      van.add(document.body, contentDiv);

      function renderNotes() {
        const notes = getNotesFromLocalStorage();
        const notesEl = document.getElementById("notes");

        notesEl.innerHTML = "";

        notes.forEach((note) => {
          const currentLocale = navigator.language;
          let dateStr = new Date(note.timestamp).toLocaleString(currentLocale, {
            month: "short",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
            weekday: "short",
            hour12: false,
          });

          const noteItem = li(
            div(
              { class: "header" },
              h3(dateStr),
              div(
                { class: "buttonContainer" },
                button(
                  { class: "edit", onclick: () => editNote(note, noteItem) },
                  "✏️"
                ),
                button(
                  { class: "delete", onclick: () => deleteNote(note) },
                  "❌"
                )
              )
            ),
            p(note.note)
          );

          van.add(notesEl, noteItem);
        });
      }

      function editNote(note, noteItem) {
        const pElement = noteItem.querySelector("p");
        const textareaElement = textarea(
          { class: "card-edit" },
          pElement.textContent
        );
        noteItem.replaceChild(textareaElement, pElement);

        const editButtonContainer = div(
          { class: "card-edit-button-container" },
          button(
            { class: "card-edit-button", onclick: () => renderNotes() },
            "Cancel"
          ),
          button(
            {
              class: "card-edit-button",
              onclick: () => saveEditedNote(note, textareaElement.value),
            },
            "Save"
          )
        );

        van.add(noteItem, editButtonContainer);
      }

      function saveNote() {
        const inputEl = document.getElementById("note");
        const note = inputEl.value;
        inputEl.value = "";

        saveNoteToLocalStorage(note);

        renderNotes();
      }

      function saveNoteToLocalStorage(note) {
        // get notes from local storage
        let notes = [];
        try {
          notes = JSON.parse(localStorage.getItem("notes")) || [];
        } catch (err) {
          console.error(err);
        }

        // remove invalid notes
        notes = notes.filter((note) => note && note.timestamp && note.note);

        // add new note
        notes.push({
          timestamp: Date.now(),
          note,
        });

        // save notes to local storage
        localStorage.setItem("notes", JSON.stringify(notes));
      }

      function getNotesFromLocalStorage() {
        return JSON.parse(localStorage.getItem("notes")) || [];
      }

      function saveEditedNote(note, newText) {
        const notes = getNotesFromLocalStorage();
        const index = notes.findIndex((n) => n.timestamp === note.timestamp);
        notes[index].note = newText;
        localStorage.setItem("notes", JSON.stringify(notes));
        renderNotes();
      }

      function deleteNote(note) {
        if (!confirm("Are you sure you want to delete this note?")) {
          return;
        }

        const notes = getNotesFromLocalStorage();
        const index = notes.findIndex((n) => n.timestamp === note.timestamp);
        notes.splice(index, 1);
        localStorage.setItem("notes", JSON.stringify(notes));
        renderNotes();
      }

      function saveNote() {
        const noteText = document.getElementById("note").value;
        if (noteText) {
          const notes = getNotesFromLocalStorage();
          notes.push({ note: noteText, timestamp: Date.now() });
          localStorage.setItem("notes", JSON.stringify(notes));
          document.getElementById("note").value = "";
          renderNotes();
        }
      }

      renderNotes();
    </script>
  </body>
</html>
